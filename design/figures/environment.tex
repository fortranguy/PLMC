\documentclass{standalone}

\input figures/figures.sty

\begin{document}

    \begin{tikzpicture}
        \begin{package}{Environment}

            \begin{scope}
                \begin{abstractclass}[text width=\mediumTextWidth]{PeriodicBox}{0, 0}
                    \operation{set(size\type{double[3]})}
                    \operation{getSize()\type{double[3]}}
                    \operation{distance(position1\type{double[3]}, position2\type{double[3]})
                        \type{double}}
                    \operation{vector(position1\type{double[3]}, position2\type{double[3]})
                        \type{double[3]}}
                    \operation[0]{folded(position\type{double[3]})\type{double[3]}}
                \end{abstractclass}
            \end{scope}

            \begin{scope}[shift={($(PeriodicBox.north) + (0 cm, 6 cm)$)}]
                \begin{abstractclass}[text width=\mediumTextWidth]{ParallelepipedDomain}{0, 0}
                    \operation{construct(periodicBox\type{PeriodicBox}, origin\type{double[3]},
                        size\type{double[3]})}
                    \operation{destroy()}
                    \operation{getOrigin()\type{double[3]}}
                    \operation{getSize()\type{double[3]}}
                    \operation{isInside(position\type{double[3]})\type{bool}}
                \end{abstractclass}
            \end{scope}

            \begin{scope}[shift={($(PeriodicBox.north) + (11 cm, 0 cm)$)}]
                \begin{abstractclass}[text width=\mediumTextWidth]{ReciprocalLattice}{0, 0}
                    \operation{contruct(periodicBox\type{PeriodicBox}, numbers\type{int[3]})}
                    \operation{destroy()}
                    \operation{getNumbers()\type{int[3]}}
                \end{abstractclass}
            \end{scope}

            \begin{scope}[shift={($(PeriodicBox.north) + (-9 cm, 0 cm)$)}]
                \begin{abstractclass}[text width=\smallTextWidth]{Temperature}{0, 0}
                    \operation{set(temperature\type{double})}
                    \operation{get()\type{double}}
                \end{abstractclass}
                % Parallel Tempering?
            \end{scope}

            \begin{scope}[shift={($(Temperature.north) + (0 cm, 4 cm)$)}]
                \begin{abstractclass}[text width=\smallTextWidth]{Permittivity}{0, 0}
                    \operation{set(permittivity\type{double})}
                    \operation{get()\type{double}}
                \end{abstractclass}
            \end{scope}
            
            \begin{scope}[shift={($(Permittivity.north) + (0 cm, 4 cm)$)}]
                \begin{abstractclass}[text width=\smallTextWidth]{FieldExpression}{0, 0}
                    \operation{get(position\type{double[3]})\type{double[3]}}
                \end{abstractclass}
            \end{scope}

            \begin{scope}[shift={($(ParallelepipedDomain.north) + (0 cm, 5 cm)$)}]
                \begin{abstractclass}[text width=\mediumTextWidth]{ExternalField}{0, 0}
                    \operation{construct(parallelepipedDomain\type{ParallelepipedDomain},
                        fieldExpression\type{FieldExpression})}
                    \operation{destroy()}
                    \operation{get(position\type{double[3]})\type{double[3]}}
                \end{abstractclass}
            \end{scope}
            
            \begin{scope}[shift={($(ReciprocalLattice.north) + (0 cm, 4 cm)$)}]
                \begin{abstractclass}[text width=\mediumTextWidth]{FloorPenetration}{0, 0}
                    \operation{meet(overlap\type{bool}, shortestVectorFromFloor\type{double[3]},
                        positionFromFloor\type{double[3]})}
                \end{abstractclass}
            \end{scope}

            \begin{scope}[shift={($(FloorPenetration.north) + (0 cm, 6 cm)$)}]
                \begin{abstractclass}[text width=\mediumTextWidth]{WallsPotential}{0, 0}
                    \operation{construct(periodicBox\type{PeriodicBox}, gap\type{double},
                        floorPenetration\type{FloorPenetration})}
                    \operation{destroy()}
                    \operation{getGap()\type{double}}
                    \operation{visit(overlap\type{bool}, energy\type{double}, position\type{double[3]},
                        pairPotential\type{\namespace{ShortInteractions}PairPotential})}
                \end{abstractclass}
            \end{scope}

        \end{package}

        \begin{scope}[on background layer]
            \aggregation{ParallelepipedDomain}{periodicBox}{1}{PeriodicBox}
            \aggregation{ReciprocalLattice}{periodicBox}{1}{PeriodicBox}
            \composition{ExternalField}{parallelepipedDomain}{1}{ParallelepipedDomain}
            \composition{ExternalField}{fieldExpression}{1}{FieldExpression}
            \aggregation{WallsPotential}{perdiodicBox}{1}{PeriodicBox}
            \composition{WallsPotential}{floorPenetration}{1}{FloorPenetration}
        \end{scope}
    \end{tikzpicture}

\end{document}
