\documentclass{standalone}

\input figures/figures.sty

\begin{document}

    \begin{tikzpicture}

        \begin{package}{Short interactions}

            \begin{scope}
                \begin{abstractclass}[text width=\mediumTextWidth]{PairPotential}{0, 0}
                    \operation[0]{construct(domain\type{ShortPotentialDomain},
                        expression\type{PotentialExpression})}
                    \operation[0]{destroy()}
                    \operation{getMaxDistance()\type{double}}
                    \operation[0]{meet(overlap\type{bool}, energy\type{double},
                        distance\type{double})}
                \end{abstractclass}
            \end{scope}

            \begin{scope}[shift={($(PairPotential.south) + (0 cm, -1.5 cm)$)}]
            \begin{abstractclass}[text width=\smallTextWidth]{PotentialExpression}{0, 0}
                    \operation{get(distance : double) : double}
                \end{abstractclass}
            \end{scope}

            \begin{scope}[shift={($(PairPotential.north) + (0 cm, 6 cm)$)}]
                \begin{abstractclass}[text width=\largeTextWidth]{ShortPairsVisitor}{0, 0}
                    \operation{construct(periodicBox\type{\namespace{Environment}PeriodicBox})}
                    \operation{destroy()}
                    \operation{visitInter(overlap\type{bool}, energy\type{double},
                        positions1\type{\namespace{Mixture}ComponentCoordinates},
                        positions2\type{\namespace{Mixture}ComponentCoordinates},
                        pairPotential\type{PairPotential})}
                    \operation{visitIntra(overlap\type{bool}, energy\type{double},
                        positions\type{\namespace{Mixture}ComponentCoordinates},
                        pairPotential\type{PairPotential})}
                \end{abstractclass}
            \end{scope}

            \begin{scope}[shift={($(ShortPairsVisitor.north) + (-13 cm, 0 cm)$)}]
                \begin{abstractclass}[text width=\largeTextWidth]{VisitableCells}{0, 0}
                    \operation{construct(listMold\type{VisitableList},
                        periodicBox\type{\namespace{Environment}PeriodicBox},
                        positions\type{\namespace{Mixture}ComponentCoordinates},
                        pairPotential\type{PairPotential})}
                    \operation{destroy()}
                    \operation{visit(overlap\type{bool}, energy\type{double},
                        particle\type{\namespace{Mixture}TemporaryParticle}, iExclude\type{int})}
                    \operation{move(toPosition\type{double[3]},
                        from\type{\namespace{Mixture}TemporaryParticle})}
                    \operation{add(particle\type{\namespace{Mixture}TemporaryParticle})}
                    \operation{remove(particle\type{\namespace{Mixture}TemporaryParticle})}
                \end{abstractclass}
            \end{scope}

            \begin{scope}[shift={($(VisitableCells.south) + (0 cm, -2 cm)$)}]
                \begin{abstractclass}[text width=\largeTextWidth]{VisitableList}{0, 0}
                    \operation{construct(periodicBox\type{\namespace{Environment}PeriodicBox},
                        componentPositions\type{\namespace{Mixture}ComponentCoordinates})}
                    \operation{destroy()}
                    \operation{set(iTarger\type{int}, iParticle\type{int})}
                    \operation{visit(overlap\type{bool}, energy\type{double},
                        particle\type{\namespace{Mixture}TemporaryParticle},
                        pairPotential\type{PairPotential}, iExclude\type{int})}
                    \operation{add(iParticle\type{int})}
                    \operation{remove(iParticle\type{int})}
                \end{abstractclass}
            \end{scope}

        \end{package}

        \begin{scope}[on background layer]
            \aggregation{VisitableCells}{pairPotential}{1}{PairPotential}
            \composition{VisitableCells}{visitableList}{1..n}{VisitableList}
            \composition{PairPotential}{potentialExpression}{1}{PotentialExpression}
        \end{scope}

    \end{tikzpicture}

\end{document}
