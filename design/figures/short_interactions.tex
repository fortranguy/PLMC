\documentclass{standalone}

\usepackage{luatex85}
\renewcommand{\familydefault}{\sfdefault}
\input figures/figures.sty

\begin{document}

    \begin{tikzpicture}[scale=\scale, every node/.style={scale=\scale}]

        \begin{scope}
            \begin{abstractclass}[text width=\largeTextWidth]{VisitableCells}{0, 0}
                \operation{\procedure{construct}{periodicBox: \type{PeriodicBox},
                    positions: \type{ComponentCoordinates}, hardContact: \type{HardContact},
                    pairPotential: \type{PairPotential}, neighbourCells: \type{NeighbourCells},
                    listMold: \type{VisitableList}}}
                \operation{\procedure{destroy}{}}
                \operation{\procedure{reset}{}}
                \operation{\procedure{target}{neighbourCells: \type{NeighbourCells}}}
                \operation{\procedure{visitEnergy}{overlap: \type{bool}, energy: \type{real},
                    particle: \type{TemporaryParticle},
                    visitCondition: \procedure{visitCondition}
                        {iInside: \type{int}, iOutside: \type{int}},
                    iExclude: \type{int}}}
                \operation{\procedure{visitContacts}{overlap: \type{bool}, contacts: \type{real},
                    particle: \type{TemporaryParticle},
                    visitCondition: \procedure{visitCondition}
                        {iInside: \type{int}, iOutside: \type{int}},
                    iExclude: \type{int}}}
                \operation{\procedure{visitMinDistance}{overlap: \type{bool}, ratio: \type{real},
                    particle: \type{TemporaryParticle},
                    visitCondition: \procedure{visitCondition}
                        {iInside: \type{int}, iOutside: \type{int}},
                    iExclude: \type{int}}}
                \operation{\procedure{translate}{toPosition: \type{real[\numDimensions]},
                    from: \type{TemporaryParticle}}}
                \operation{\procedure{add}{particle: \type{TemporaryParticle}}}
                \operation{\procedure{remove}{particle: \type{TemporaryParticle}}}
            \end{abstractclass}
        \end{scope}

        \begin{scope}[shift={($(VisitableCells.north) + (0 cm, 7 cm)$)}]
            \begin{abstractclass}[text width=\largeTextWidth]{HardContact}{0, 0}
                \operation{\procedure{construct}{accessibleDomain: \type{ParallelepipedDomain},
                    diracPlus: \type{DiracDistributionPlus}}}
                \operation{\procedure{destroy}{}}
                \operation{\procedure{getWidth}{}: \type{real}}
                \operation[0]{\procedure{meetContact}{overlap: \type{bool}, contact: \type{real},
                    minDistance: \type{real}, vector: \type{real[\numDimensions]}}}
                \operation[0]{\procedure{meetMinDistance}{canOverlap: \type{bool},
                    overlap: \type{bool}, ratio: \type{real}, minDistance: \type{real},
                    vector: \type{real[\numDimensions]}}}
            \end{abstractclass}
        \end{scope}

        \begin{scope}[shift={($(HardContact.north) - (9 cm, 0 cm)$)}]
            \begin{abstractclass}[text width=\mediumTextWidth]{DiracDistributionPlus}{0, 0}
                \operation[0]{\procedure{set}{\ldots}}
                \operation[0]{\procedure{getWidth}{}: \type{real}}
                \operation[0]{\procedure{get}{distance: \type{real}}: \type{real}}
            \end{abstractclass}
        \end{scope}

        \begin{scope}[shift={($(DiracDistributionPlus.south) - (0 cm, 1.5 cm)$)}]
            \begin{abstractclass}[text width=\largeTextWidth]{VisitableList}{0, 0}
                \operation{\procedure{construct}{periodicBox: \type{PeriodicBox},
                    positions: \type{ComponentCoordinates}, hardContact: \type{HardContact}}}
                \operation{\procedure{destroy}{}}
                \operation{\procedure{set}{iTarger: \type{int}, iParticle: \type{int}}}
                \operation{\procedure{visitEnergy}{overlap: \type{bool}, energy: \type{real},
                    particle: \type{TemporaryParticle},
                    pairPotential: \type{PairPotential},
                    visitCondition: \procedure{visitCondition}
                        {iInside: \type{int}, iOutside: \type{int}},
                    iExclude: \type{int}}}
                \operation{\procedure{visitContacts}{overlap: \type{bool}, contacts: \type{real},
                    particle: \type{TemporaryParticle},
                    minDistance: \type{real},
                    visitCondition: \procedure{visitCondition}
                        {iInside: \type{int}, iOutside: \type{int}},
                    iExclude: \type{int}}}
                \operation{\procedure{visitMinDistance}{overlap: \type{bool}, ratio: \type{real},
                    particle: \type{TemporaryParticle},
                    minDistance: \type{real}, maxDistance: \type{real},
                    visitCondition: \procedure{visitCondition}
                        {iInside: \type{int}, iOutside: \type{int}},
                    iExclude: \type{int}}}
                \operation{\procedure{add}{iParticle: \type{int}}}
                \operation{\procedure{remove}{iParticle: \type{int}}}
            \end{abstractclass}
        \end{scope}

        \begin{scope}[shift={($(VisitableCells.south) - (0 cm , 1.5 cm)$)}]
            \begin{abstractclass}[text width=\largeTextWidth]{PairPotential}{0, 0}
                \operation[0]{\procedure{construct}{domain: \type{PotentialDomain},
                    expression: \type{PotentialExpression}}}
                \operation[0]{\procedure{destroy}{}}
                \operation{\procedure{getMinDistance}{}: \type{real}}
                \operation{\procedure{getMaxDistance}{}: \type{real}}
                \operation[0]{\procedure{meet}{overlap: \type{bool}, energy: \type{real},
                    distance: \type{real}}}
            \end{abstractclass}
        \end{scope}

        \begin{scope}[shift={($(HardContact.north) + (9 cm, 0 cm)$)}]
            \coordinate (Import) at (0, 0);
            \umlnote[text width=\largeTextWidth] {\import{}: \\
                \namespace{Common} :: PotentialDomain \\
                \namespace{Environment} :: PeriodicBox, ParallelepipedDomain, WallsVisitor,
                    BetaPressureExcess \\
                \namespace{Mixture} :: ComponentCoordinates, TemporaryParticle};
        \end{scope}

        \begin{scope}[shift={($(VisitableList.south) - (0 cm, 1.5 cm)$)}]
            \begin{abstractclass}[text width=\largeTextWidth]{NeighbourCells}{0, 0}
                \operation{\procedure{construct}{accessibleDomain: \type{ParallelepipedDomain},
                    hardContact: \type{HardContact}, pairPotential: \type{PairPotential}}}
                \operation{\procedure{destroy}{}}
                \operation{\procedure{resizeOnly}{}: \type{bool}}
                \operation{\procedure{reset}{}}
                \operation{\procedure{getGlobalLbounds}{}: \type{int[\numDimensions]}}
                \operation{\procedure{getGlobalUbounds}{}: \type{int[\numDimensions]}}
                \operation{\procedure{get}{localI1: \type{int}, localI2: \type{int},
                    localI3: \type{int}, globalI1: \type{int}, globalI2: \type{int},
                    globalI3: \type{int}}: \type{int[\numDimensions]}}
                \operation{\procedure{skip}{atBottomLayer: \type{bool},
                    atTopLayer: \type{bool}, localI3: \type{int}}: \type{bool}}
                \operation{\procedure{isInside}{position: \type{real[\numDimensions]}}: \type{bool}}
                \operation{\procedure{index}{position: \type{real[\numDimensions]}}:
                    \type{int[\numDimensions]}}
            \end{abstractclass}
        \end{scope}

        \begin{scope}[shift={($(NeighbourCells.south) - (0 cm, 1.5 cm)$)}]
            \begin{abstractclass}[text width=\mediumTextWidth]{PotentialExpression}{0, 0}
                \operation{\procedure{get}{distance: \type{real}}: \type{real}}
            \end{abstractclass}
        \end{scope}

        \begin{scope}[shift={($(Import) - (0 cm, 4 cm)$)}]
            \begin{class}[text width=\largeTextWidth]{ShortInteractions}{0, 0}
                \UMLattribute{betaPressuresExcess: \type{BetaPressureExcess[\numBoxes]}}
                \UMLattribute{hardContact: \type{HardContact}}
                \UMLattribute{wallsVisitors: \type{WallsVisitor[\numBoxes]}}
                \UMLattribute{wallPairs: \type{PairPotential[\numComponents]}}
                \UMLattribute{componentsVisitors: \type{ShortPairsVisitor[\numBoxes]}}
                \UMLattribute{componentsPairs:
                    \type{PairPotential[\numComponents, \numComponents]\textsubscript{\sym}}}
                \UMLattribute{cells: \type{Cells}[\numBoxes]}
                \UMLattribute{visitableCellsMemento: \type{VisitableCellsMemento}}
            \end{class}
        \end{scope}

        \begin{scope}[shift={($(ShortInteractions.south) - (0 cm, 1.5 cm)$)}]
            \begin{class}[text width=\largeTextWidth]{Cells}{0, 0}
                \UMLattribute{neighbourCells:
                    \type{NeighbourCells[\numComponents, \numComponents]\textsubscript{\sym}}}
                \UMLattribute{visitableCells: \type{VisitableCells[\numComponents, \numComponents]}}
            \end{class}
        \end{scope}

        \begin{scope}[shift={($(Cells.south) - (0 cm, 1.5 cm)$)}]
            \begin{abstractclass}[text width=\largeTextWidth]{ShortPairsVisitor}{0, 0}
                \operation{\procedure{construct}{periodicBox: \type{PeriodicBox}}}
                \operation{\procedure{destroy}{}}
                \operation{\procedure{visitInter}{overlap: \type{bool}, energy: \type{real},
                    positions1: \type{ComponentCoordinates},
                    positions2: \type{ComponentCoordinates},
                    pairPotential: \type{PairPotential}}}
                \operation{\procedure{visitIntra}{overlap: \type{bool}, energy: \type{real},
                    positions: \type{ComponentCoordinates}, pairPotential: \type{PairPotential}}}
            \end{abstractclass}
        \end{scope}

        \begin{scope}[shift={($(ShortPairsVisitor.south) - (0 cm, 1.5 cm)$)}]
            \begin{abstractclass}[text width=\largeTextWidth]{VisitableCellsMemento}{0, 0}
                \operation[0]{\procedure{save}{visitableCellsTarget: \type{VisitableCells},
                    visitableCellsSource: \type{VisitableCells}}}
                \operation[0]{\procedure{restore}{visitableCellsTarget: \type{VisitableCells},
                    neighbourCells: \type{NeighbourCells},
                    visitableCellsSource: \type{VisitableCells}}}
            \end{abstractclass}
        \end{scope}

        \begin{scope}[on background layer]
            \aggregation{VisitableCells}{\refName{neighbourCells}}{\numRef{1}}{NeighbourCells}
            \aggregation{VisitableCells}{\refName{pairPotential}}{\numRef{1}}{PairPotential}
            \composition{VisitableCells}{\refName{visitableList}}{\numRef{1..n}}{VisitableList}
            \composition{PairPotential}{\refName{potentialExpression}}{\numRef{1}}
                {PotentialExpression}
            \aggregation{VisitableList}{\refName{hardContact}}{\numRef{1}}{HardContact}
            \composition{HardContact}{\refName{diracPlus}}{\numRef{1}}{DiracDistributionPlus}
        \end{scope}

    \end{tikzpicture}

\end{document}
