\begin{scope}[shift={($(Material.north) + (42 cm, 55 cm)$)}]
    \begin{package}{Dipolar interactions}
    
        \begin{scope}[local bounding box=DipolarInteraction]
            \begin{class}[text width=\largeTextWidth]{DipolarInteractionFacade}{0, 8}
                \operation{totalEnergy() : double}
                \operation{totalEnergyUsingField() : double}
                \operation{reset()}
                \operation{moveEnergy(old : Particle, new : Particle) : double}
                \operation{moveUpdate(old : Particle, new : Particle)}
                \operation{rotationEnergy(old : Particle, new : Particle) : double}
                \operation{rotationUpdate(old : Particle, new : Particle)}
                \operation{exchangeEnergy(particle : Particle) : double}
                \operation{exchangeUpdate(particle : Particle)}
                \operation{volumeChangeEnergy(dilatation : double, oldEnergy : double) : double}
                \operation{volumeChangeRestoration(dilatation : double)}
                \operation{soloField(particle : Particle) : double[3]}
                \operation{testField(particle : Particle) : double[3]}
            \end{class}
            
            \begin{abstractclass}[text width=\largeTextWidth]{AbstractDipolarInteraction}{0, 0}
                \operation[0]{totalEnergy() : double}
                \operation[0]{totalEnergyUsingField() : double}
                \operation[0]{moveEnergy(old : Particle, new : Particle) : double}
                \operation[0]{rotationEnergy(old : Particle, new : Particle) : double}
                \operation[0]{exchangeEnergy(particle : Particle) : double}
                \operation[0]{volumeChangeEnergy(dilatation : double, oldEnergy : double) : double}
                \operation[0]{soloField(particle : Particle) : double[3]}
                \operation[0]{testField(particle : Particle) : double[3]}
            \end{abstractclass}
            
            \begin{abstractclass}[text width=\largeTextWidth]{AbstractReciInteraction}{0, -6}
                \inherit{AbstractDipolarInteraction}
                \operation[0]{moveUpdate(old : Particle, new : Particle)}
                \operation[0]{rotationUpdate(old : Particle, new : Particle)}
                \operation[0]{exchangeUpdate(particle : Particle)}
                \operation[0]{volumeChangeRestoration(dilatation : double)}
            \end{abstractclass}
        \end{scope}
        
        \begin{scope}[shift={($(DipolarInteraction.south) + (-19.5 cm, -5 cm)$)}]
            \begin{abstractclass}[text width=\largeTextWidth]{AbstractEwaldReal}{0, 0}
                \inherit{AbstractDipolarInteraction}
                \operation[0]{volumeChangeRestoration(dilatation : double)}
            \end{abstractclass}

            \def\operationsImplementation{
                \operation{totalEnergy() : double}
                \operation{totalEnergyUsingField() : double}
                \operation{moveEnergy(old : Particle, new : Particle) : double}
                \operation{rotationEnergy(old : Particle, new : Particle) : double}
                \operation{exchangeEnergy(particle : Particle) : double}
                \operation{volumeChangeEnergy(dilatation : double, oldEnergy : double) : double}
                \operation{volumeChangeRestoration(dilatation : double)}
                \operation{soloField(particle : Particle) : double[3]}
                \operation{testField(particle : Particle) : double[3]}
            }
            
            \begin{class}[text width=\largeTextWidth]{NullEwaldReal}{0, -2.5}
                \inherit{AbstractEwaldReal}
                \operationsImplementation{}
            \end{class}
            
            \begin{class}[text width=\largeTextWidth]{EwaldReal}{0, -8}
                \inherit{AbstractEwaldReal}
                \operationsImplementation{}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={($(DipolarInteraction.south) + (-6.5 cm, -5 cm)$)}]
            \begin{abstractclass}[text width=\largeTextWidth]{AbstractEwaldReci}{0, 0}
                \inherit{AbstractReciInteraction}
            \end{abstractclass}

            \def\operationsImplementation{
                \operation{totalEnergy() : double}
                \operation{totalEnergyUsingField() : double}
                \operation{moveEnergy(old : Particle, new : Particle) : double}
                \operation{moveUpdate(old : Particle, new : Particle)}
                \operation{rotationEnergy(old : Particle, new : Particle) : double}
                \operation{rotationUpdate(old : Particle, new : Particle)}
                \operation{exchangeEnergy(particle : Particle) : double}
                \operation{exchangeUpdate(particle : Particle)}
                \operation{volumeChangeEnergy(dilatation : double, oldEnergy : double) : double}
                \operation{volumeChangeRestoration(dilatation : double)}
                \operation{soloField(particle : Particle) : double[3]}
                \operation{testField(particle : Particle) : double[3]}
            }
            
            \begin{class}[text width=\largeTextWidth]{NullEwaldReci}{0, -2}
                \inherit{AbstractEwaldReci}
                \operationsImplementation{}
            \end{class}
            
            \begin{class}[text width=\largeTextWidth]{EwaldReci}{0, -9}
                \inherit{AbstractEwaldReci}
                \operationsImplementation{}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={($(DipolarInteraction.south) + (6.5 cm, -5 cm)$)}]
            \begin{abstractclass}[text width=\largeTextWidth]{AbstractDipolarLayerCorrection}{0, 0}
                \inherit{AbstractReciInteraction}
            \end{abstractclass}

            \def\operationsImplementation{
                \operation{totalEnergy() : double}
                \operation{totalEnergyUsingField() : double}
                \operation{moveEnergy(old : Particle, new : Particle) : double}
                \operation{moveUpdate(old : Particle, new : Particle)}
                \operation{rotationEnergy(old : Particle, new : Particle) : double}
                \operation{rotationUpdate(old : Particle, new : Particle)}
                \operation{exchangeEnergy(particle : Particle) : double}
                \operation{exchangeUpdate(particle : Particle)}
                \operation{volumeChangeEnergy(dilatation : double, oldEnergy : double) : double}
                \operation{volumeChangeRestoration(dilatation : double)}
                \operation{soloField(particle : Particle) : double[3]}
                \operation{testField(particle : Particle) : double[3]}
            }
            
            \begin{class}[text width=\largeTextWidth]{NullDipolarLayerCorrection}{0, -2}
                \inherit{AbstractDipolarLayerCorrection}
                \operationsImplementation{}
            \end{class}
            
            \begin{class}[text width=\largeTextWidth]{DipolarLayerCorrection}{0, -9}
                \inherit{AbstractDipolarLayerCorrection}
                \operationsImplementation{}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={($(DipolarInteraction.south) + (19.5 cm, -5 cm)$)}]
            \begin{abstractclass}[text width=\largeTextWidth]{AbstractEwaldSelf}{0, 0}
                \inherit{AbstractDipolarInteraction}
            \end{abstractclass}

            \def\operationsImplementation{
                \operation{totalEnergy() : double}
                \operation{totalEnergyUsingField() : double}
                \operation{moveEnergy(old : Particle, new : Particle) : double}
                \operation{rotationEnergy(old : Particle, new : Particle) : double}
                \operation{exchangeEnergy(particle : Particle) : double}
                \operation{volumeChangeEnergy(dilatation : double, oldEnergy : double) : double}
                \operation{soloField(particle : Particle) : double[3]}
                \operation{testField(particle : Particle) : double[3]}
            }
            
            \begin{class}[text width=\largeTextWidth]{NullEwaldSelf}{0, -2}
                \inherit{AbstractEwaldSelf}
                \operationsImplementation{}
            \end{class}
            
            \begin{class}[text width=\largeTextWidth]{EwaldSelf}{0, -7}
                \inherit{AbstractEwaldSelf}
                \operationsImplementation{}
            \end{class}
            
        \end{scope}
        
        \begin{scope}[shift={($(DipolarInteraction.south) + (32.5 cm, -5 cm)$)}]
            \begin{abstractclass}[text width=\largeTextWidth]{AbstractEwaldBound}{0, 0}
                \inherit{AbstractDipolarInteraction}
            \end{abstractclass}

            \def\operationsImplementation{
                \operation{totalEnergy() : double}
                \operation{totalEnergyUsingField() : double}
                \operation{moveEnergy(old : Particle, new : Particle) : double}
                \operation{rotationEnergy(old : Particle, new : Particle) : double}
                \operation{exchangeEnergy(particle : Particle) : double}
                \operation{volumeChangeEnergy(dilatation : double, oldEnergy : double) : double}
                \operation{soloField(particle : Particle) : double[3]}
                \operation{testField(particle : Particle) : double[3]}
            }
            
            \begin{class}[text width=\largeTextWidth]{NullEwaldBound}{0, -2}
                \inherit{AbstractEwaldBound}
                \operationsImplementation{}
            \end{class}
            
            \begin{class}[text width=\largeTextWidth]{EwaldBound}{0, -7}
                \inherit{AbstractEwaldBound}
                \operationsImplementation{}
            \end{class}
        \end{scope}

        \begin{scope}[shift={($(DipolarInteraction.south) + (45.5 cm, -5 cm)$)}]
            \begin{abstractclass}[text width=\largeTextWidth]{AbstractFieldInteraction}{0, 0}
                \inherit{AbstractDipolarInteraction}
            \end{abstractclass}

            \def\operationsImplementation{
                \operation{totalEnergy() : double}
                \operation{totalEnergyUsingField() : double}
                \operation{moveEnergy(old : Particle, new : Particle) : double}
                \operation{rotationEnergy(old : Particle, new : Particle) : double}
                \operation{exchangeEnergy(particle : Particle) : double}
                \operation{volumeChangeEnergy(dilatation : double, oldEnergy : double) : double}
                \operation{soloField(particle : Particle) : double[3]}
                \operation{testField(particle : Particle) : double[3]}
            }

            \begin{class}[text width=\largeTextWidth]{NullFieldInteraction}{0, -2}
                \inherit{AbstractFieldInteraction}
                \operationsImplementation{}
            \end{class}

            \begin{class}[text width=\largeTextWidth]{FieldInteraction}{0, -7}
                \inherit{AbstractFieldInteraction}
                \operationsImplementation{}
            \end{class}
        \end{scope}
    
    \end{package}
\end{scope}

\begin{scope}[on background layer]
    \aggregation{DipolarInteractionFacade}{ewaldReal}{2}{AbstractEwaldReal}
    \aggregation{DipolarInteractionFacade}{ewaldReci}{2}{AbstractEwaldReci}
    \aggregation{DipolarInteractionFacade}{dlc}{2}{AbstractDipolarLayerCorrection}
    \aggregation{DipolarInteractionFacade}{ewaldSelf}{1}{AbstractEwaldSelf}
    \aggregation{DipolarInteractionFacade}{ewaldBound}{2}{AbstractEwaldBound}
    \aggregation{DipolarInteractionFacade}{fieldInteraction}{1}{AbstractFieldInteraction}

    \aggregation{AbstractDipolarInteraction}{box}{1}{AbstractBoxGeometry}

    \aggregation{EwaldReal}{spheres}{1}{AbstractDipolarSpheres}

    \aggregation{EwaldReci}{spheres}{1}{AbstractDipolarSpheres}

    \aggregation{DipolarLayerCorrection}{spheres}{1}{AbstractDipolarSpheres}

    \aggregation{EwaldSelf}{spheres}{1}{AbstractDipolarSpheres}

    \aggregation{EwaldBound}{totalMoment}{1}{AbstractTotalMoment}

    \aggregation{FieldInteraction}{totalMoment}{1}{AbstractTotalMoment}
    \aggregation{FieldInteraction}{extField}{1}{AbstractExternalField}
\end{scope}[on background layer]
