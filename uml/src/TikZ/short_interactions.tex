\begin{scope}[shift={($(Material.north) + (-20 cm, 55 cm)$)}]
    \begin{package}{Short range interactions}
    
        \begin{scope}[local bounding box=ShortInteraction]
            \begin{class}[text width=\extraLargeTextWidth]{ShortInteractionFacade}{0, 5}
                \operation{totalEnergy() : double}
                \operation{soloEnergy(particle : Particle, overlap : bool, energy : double)}
                \operation{moveUpdate(old : Particle, new : Particle)}
                \operation{exchangeUpdate(particle : particle)}
                \operation{volumeChangeEnergy(dilatation : double, overlap : bool, energy : double)}
                \operation{volumeChangeRestoration(dilatation : double)}
                \operation{overlapTest()}
            \end{class}
        
            \begin{abstractclass}[text width=\extraLargeTextWidth]{AbstractShortInteraction}{0, 0}
                \operation[0]{totalEnergy() : double}
                \operation[0]{soloEnergy(particle : Particle, overlap : bool, energy : double)}
                \operation[0]{volumeChangeEnergy(dilatation : double, overlap : bool, energy : double)}
                \operation[0]{overlapTest()}
            \end{abstractclass}
        \end{scope}
    
        \begin{scope}[local bounding box=PairInteraction,
            shift={($(ShortInteraction.south) + (-8 cm, -2.5 cm)$)}]
            \begin{abstractclass}[text width=\extraLargeTextWidth]{AbstractPairInteraction}{0, 0}
                \inherit{AbstractShortInteraction}
                \operation{soloEnergy(particle : Particle, overlap : bool, energy : double)}
                \operation[0]{moveUpdate(old : Particle, new : Particle)}
                \operation[0]{exchangeUpdate(particle : particle)}
                \operation[0]{volumeChangeRestoration(dilatation : double)}                
            \end{abstractclass}

            \def\operationsImplementation{
                \operation{totalEnergy() : double}
                \operation{moveUpdate(old : Particle, new : Particle)}
                \operation{exchangeUpdate(particle : particle)}
                \operation{volumeChangeEnergy(dilatation : double, overlap : bool, energy : double)}
                \operation{volumeChangeRestoration(dilatation : double)}
                \operation{overlapTest()}
            }
            
            \begin{class}[text width=\extraLargeTextWidth]{IntraPairInteration}{0, -4}
                \inherit{AbstractPairInteraction}
                \operationsImplementation{}
            \end{class}            
            
            \begin{class}[text width=\extraLargeTextWidth]{InterPairInteration}{0, -8.5}
                \inherit{AbstractPairInteraction}
                \operationsImplementation{}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={($(PairInteraction.south) + (-8 cm, -4 cm)$)}]
            \begin{abstractclass}[text width=\largeTextWidth]{AbstractNeighbourCells}{0, 0}
                \operation{fill()}
                \operation{index(position : double[3]) : int}
                \operation[0]{boundBegin(iCell : int) : int}
                \operation[0]{boundEnd(iCell : int) : int}
                \operation{toBegin(current : Node, iNearCell : int, iTotalCell : int)}
                \operation{add(iSphere : int, iCell : int)}
                \operation{remove(iSphere : int, iCell : int)}
                \operation{copy(iSphereSource : int, iSphereTarget : int, iCellTarget : int)}
            \end{abstractclass}

            \def\operationsImplementation{
                \operation{boundBegin(iCell : int) : int}
                \operation{boundEnd(iCell : int) : int}
            }
            
            \begin{class}[text width=\largeTextWidth]{BulkNeighbourCells}{0, -5.5}
                \inherit{AbstractNeighbourCells}
                \operationsImplementation{}
            \end{class}
            
            \begin{class}[text width=\largeTextWidth]{SlabNeighbourCells}{0, -8}
                \inherit{AbstractNeighbourCells}
                \operationsImplementation{}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={($(PairInteraction.south) + (8 cm, -4 cm)$)}]
            \begin{abstractclass}[text width=\mediumTextWidth]{AbstractPairPotential}{0, 0}
                \operation[0]{potential(distance : double) : double}
            \end{abstractclass}

            \def\operationsImplementation{
                \operation{potential(distance : double) : double}
            }
            
            \begin{class}[text width=\mediumTextWidth]{LJpairPotential}{0, -2.5}
                \inherit{AbstractPairPotential}
                \operationsImplementation{}
            \end{class}
            
            \begin{class}[text width=\mediumTextWidth]{HardPairPotential}{0, -4.5}
                \inherit{AbstractPairPotential}
                \operationsImplementation{}
            \end{class}
        \end{scope}
        
        \begin{scope}[local bounding box=WallInteraction, 
            shift={($(ShortInteraction.south) + (8 cm, -2.5 cm)$)}]
            \begin{abstractclass}[text width=\extraLargeTextWidth]{AbstractWallInteraction}{0, 0}
                \inherit{AbstractShortInteraction}
            \end{abstractclass}
            
            \def\operationsImplementation{
                \operation{totalEnergy() : double}
                \operation{soloEnergy(particle : Particle, overlap : bool, energy : double)}
                \operation{volumeChangeEnergy(dilatation : double, overlap : bool, energy : double)}
                \operation{overlapTest()}
            }
            
            \begin{class}[text width=\extraLargeTextWidth]{NullWallInteraction}{0, -2.5}
                \inherit{AbstractWallInteraction}
                \operationsImplementation{}
            \end{class}
            
            \begin{class}[text width=\extraLargeTextWidth]{WallInteraction}{0, -6.5}
                \inherit{AbstractWallInteraction}
                \operationsImplementation{}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={($(WallInteraction.south) + (8 cm, -3.5 cm)$)}]
            \begin{abstractclass}[text width=\mediumTextWidth]{AbstractWallPotential}{0, 0}
                \operation[0]{potential(height : double) : double}
            \end{abstractclass}
            
            \def\operationsImplementation{
                \operation{potential(height : double) : double}
            }
            
            \begin{class}[text width=\mediumTextWidth]{NullWallPotential}{0, -2.5}
                \inherit{AbstractWallPotential}
                \operationsImplementation{}
            \end{class}
            
            \begin{class}[text width=\mediumTextWidth]{IntegratedLJwallPotential}{0, -4.5}
                \inherit{AbstractWallPotential}
                \operationsImplementation{}
            \end{class}
        \end{scope}
    
    \end{package}
\end{scope}

\begin{scope}[on background layer]
    \composition{ShortInteractionFacade}{pairInteraction}{1}{AbstractPairInteraction}
    \composition{ShortInteractionFacade}{wallInteraction}{1}{AbstractWallInteraction}

    \composition{AbstractPairInteraction}{box}{1}{AbstractBoxGeometry}
    \composition{AbstractPairInteraction}{neighbourCells}{1}{AbstractNeighbourCells}
    \composition{AbstractPairInteraction}{pairPotential}{1}{AbstractPairPotential}
    \composition{IntraPairInteration}{spheres}{1}{AbstractDipolarSpheres}
    \composition{InterPairInteration}{spheres}{2}{AbstractDipolarSpheres}
    \composition{InterPairInteration}{interSpheres}{1}{AbstractInterSpheres}

    \composition{AbstractNeighbourCells}{box}{1}{AbstractBoxGeometry}
    \composition{AbstractNeighbourCells}{spheres}{1}{AbstractDipolarSpheres}
    
    \composition{AbstractWallInteraction}{wallPotential}{1}{AbstractWallPotential}
    \composition{WallInteraction}{box}{1}{AbstractBoxGeometry}
    \composition{WallInteraction}{spheres}{1}{AbstractDipolarSpheres}
\end{scope}
