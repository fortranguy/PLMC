\begin{tikzpicture}
    
    \pgfmathsetmacro{\smallTextWidth}{5 cm}
    \pgfmathsetmacro{\mediumTextWidth}{7 cm}
    \pgfmathsetmacro{\largeTextWidth}{11 cm}
    
    \begin{scope}[local bounding box=Material]
        \begin{package}{Material}
        
            \begin{scope}[local bounding box=Spheres]
                \begin{abstractclass}[text width=\mediumTextWidth]{AbstractSpheres}{0, 0}
                    \operation{getName() : String}
                    \operation{getNum() : int}
                    \operation{getDiameter() : double}
                    \operation{getPosition(iSphere : int) : double[3]}
                    \operation[0]{getMoment(iSphere : int) : double[3]}
                \end{abstractclass}
                
                \begin{class}[text width=\mediumTextWidth]{ApolarSpheres}{0, -4}
                    \inherit{AbstractSpheres}
                    \operation{getMoment(iSphere : int) : double[3]}
                \end{class}
                
                \begin{class}[text width=\mediumTextWidth]{DipolarSpheres}{0, -6}
                    \inherit{AbstractSpheres}
                    \operation{getMoment(iSphere : int) : double[3]}
                \end{class}
            \end{scope}
            
            \begin{scope}[shift={($(Spheres.north) - (11 cm, 0)$)}, local bounding box=BoxGeometry]
                \begin{abstractclass}[text width=\largeTextWidth]{AbstractBoxGeometry}{0, 0}
                    \operation{getSize() : double[3]}
                    \operation{getWave() : int[3]}
                    \operation[0]{vectorPBC(position1 : double[3], position2 : double[3]) : double[3]}
                    \operation{distancePBC(position1 : double[3], position2 : double[3]) : double}
                \end{abstractclass}
                
                \begin{class}[text width=\largeTextWidth]{BulkGeometry}{0, -4}
                    \inherit{AbstractBoxGeometry}
                    \operation{vectorPBC(position1 : double[3], position2 : double[3]) : double[3]}
                \end{class}
                
                \begin{class}[text width=\largeTextWidth]{SlabGeometry}{0, -6}
                    \inherit{AbstractBoxGeometry}
                    \operation{vectorPBC(position1 : double[3], position2 : double[3]) : double[3]}
                \end{class}
            \end{scope}
            
            \begin{scope}[shift={($(Spheres.north) + (8 cm, 0)$)}]
                \begin{abstractclass}[text width=\smallTextWidth]{AbstractInterSpheres}{0, 0}
                    \operation{getName() : String}
                    \operation{getDiameter() : double}
                \end{abstractclass}
                
                \begin{class}[text width=\smallTextWidth]{InterSpheres}{0, -3}
                    \inherit{AbstractInterSpheres}
                \end{class}
            \end{scope}
            
            \begin{scope}[shift={($(Spheres.north)!0.5!(BoxGeometry.north) + (0 cm, 11 cm)$)}]
                \begin{abstractclass}[text width=\mediumTextWidth]{AbstractBoxedSpheres}{0, 0}
                    \operation[0]{randomPosition() : double[3]}
                    \operation[0]{isInsideBox(position : double[3]) : bool}
                    \operation[0]{getAccessibleVolume() : double}
                \end{abstractclass}
                
                \begin{class}[text width=\mediumTextWidth]{BulkBoxedSpheres}{0, -3}
                    \inherit{AbstractBoxedSpheres}
                    \operation{randomPosition() : double[3]}
                    \operation{isInsideBox(position : double[3]) : bool}
                    \operation{getAccessibleVolume() : double}
                \end{class}
                
                \begin{class}[text width=\mediumTextWidth]{SlabBoxedSpheres}{0, -6}
                    \inherit{AbstractBoxedSpheres}
                    \operation{randomPosition() : double[3]}
                    \operation{isInsideBox(position : double[3]) : bool}
                    \operation{getAccessibleVolume() : double}
                \end{class}
            \end{scope}
            
        \end{package}
    \end{scope}

    \begin{scope}[on background layer]
        \composition{AbstractBoxedSpheres}{spheres}{1}{AbstractSpheres}
        \composition{AbstractBoxedSpheres}{box}{1}{AbstractBoxGeometry}
    \end{scope}
    
    \begin{scope}[shift={($(Material.north) + (-16 cm, 30cm)$)}]
        \begin{package}{Short range interaction}
        
            \begin{scope}[local bounding box=ShortInteraction]
                \begin{abstractclass}[text width=\largeTextWidth]{AbstractShortInteraction}{0, 0}
                    \operation{neighboursEnergy(particle : Particle, overlap : bool, enery : double)}
                    \operation[0]{totalEnergy() : double}
                    \operation[0]{volumeChangeEnergy(dilatation : double) : double}
                    \operation[0]{overlapTest()}
                \end{abstractclass}            
                
                \begin{class}[text width=\largeTextWidth]{IntraShortInteration}{0, -3.5}
                    \inherit{AbstractShortInteraction}
                    \operation{totalEnergy() : double}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{overlapTest()}
                \end{class}            
                
                \begin{class}[text width=\largeTextWidth]{InterShortInteration}{0, -6}
                    \inherit{AbstractShortInteraction}
                    \operation{totalEnergy() : double}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{overlapTest()}
                \end{class}
            \end{scope}
            
            \begin{scope}[shift={($(ShortInteraction.south) + (-7 cm, -2.5 cm)$)}]
                \begin{abstractclass}[text width=\largeTextWidth]{AbstractNeighbourCells}{0, 0}
                    \operation{fill()}
                    \operation{index(position : double[3]) : int}
                    \operation[0]{bounds(iCell : int) : int[2]}
                    \operation{toBegin()}
                    \operation{add(iSphere : int, iCell : int)}
                    \operation{remove(iSphere : int, iCell : int)}
                    \operation{copy(iSphereSource : int, iSphereTarget : int, iCellTarget : int)}
                \end{abstractclass}
                
                \begin{class}[text width=\largeTextWidth]{BulkNeighbourCells}{0, -5.5}
                    \inherit{AbstractNeighbourCells}
                    \operation{bounds(iCell : int) : int[2]}
                \end{class}
                
                \begin{class}[text width=\largeTextWidth]{SlabNeighbourCells}{0, -7.5}
                    \inherit{AbstractNeighbourCells}
                    \operation{bounds(iCell : int) : int[2]}
                \end{class}
            \end{scope}
            
            \begin{scope}[shift={($(ShortInteraction.south) + (5 cm, -2.5 cm)$)}]
                \begin{abstractclass}[text width=\mediumTextWidth]{AbstractPairPotential}{0, 0}
                    \operation[0]{potential(distance : double) : double}
                \end{abstractclass}
                
                \begin{class}[text width=\mediumTextWidth]{LJpairPotential}{0, -2.5}
                    \inherit{AbstractPairPotential}
                    \operation{potential(distance : double) : double}
                \end{class}
                
                \begin{class}[text width=\mediumTextWidth]{HardPairPotential}{0, -4.5}
                    \inherit{AbstractPairPotential}
                    \operation{potential(distance : double) : double}
                \end{class}
            \end{scope}
        
        \end{package}
    \end{scope}

    \begin{scope}[on background layer]
        \composition{AbstractShortInteraction}{box}{1}{AbstractBoxGeometry}
        \composition{AbstractShortInteraction}{neighbourCells}{1}{AbstractNeighbourCells}
        \composition{AbstractShortInteraction}{pairPotential}{1}{AbstractPairPotential}
        \composition{IntraShortInteration}{spheres}{1}{AbstractSpheres}
        \composition{InterShortInteration}{spheres}{2}{AbstractSpheres}
        \composition{InterShortInteration}{interSpheres}{1}{AbstractInterSpheres}

        \composition{AbstractNeighbourCells}{box}{1}{AbstractBoxGeometry}
        \composition{AbstractNeighbourCells}{spheres}{1}{AbstractSpheres}
    \end{scope}
    
    \begin{scope}[shift={($(Material.north) + (28 cm, 45cm)$)}]
        \begin{package}{Dipolar interaction}
        
            \begin{scope}[local bounding box=DipolarInteraction]
                \begin{class}[text width=\largeTextWidth]{DipolarInteractionFacade}{0, 8}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{reset()}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{moveUpdate()}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationUpdate()}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{exchangeUpdate()}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{volumeChangeUpdate(dilatation : double)}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}
                
                \begin{abstractclass}[text width=\largeTextWidth]{AbstractDipolarInteraction}{0, 0}
                    \operation[0]{totalEnergy() : double}
                    \operation[0]{totalEnergyUsingField() : double}
                    \operation[0]{moveEnergy(old : Particle, new : Particle) : double}
                    \operation[0]{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation[0]{exchangeEnergy(particle : Particle) : double}
                    \operation[0]{volumeChangeEnergy(dilatation : double) : double}
                    \operation[0]{soloField(particle : Particle) : double[3]}
                    \operation[0]{testField(particle : Particle) : double[3]}
                \end{abstractclass}
                
                \begin{abstractclass}[text width=\largeTextWidth]{AbstractReciInteraction}{0, -6}
                    \inherit{AbstractDipolarInteraction}
                    \operation[0]{reset()}
                    \operation[0]{countWaveVectors()}
                    \operation[0]{moveUpdate()}
                    \operation[0]{rotationUpdate()}
                    \operation[0]{exchangeUpdate()}
                    \operation[0]{volumeChangeUpdate(dilatation : double)}
                \end{abstractclass}           
            \end{scope}
            
            \begin{scope}[shift={($(DipolarInteraction.south) + (-19.5 cm, -2 cm)$)}]
                \begin{abstractclass}[text width=\largeTextWidth]{AbstractEwaldReal}{0, 0}
                    \inherit{AbstractDipolarInteraction}
                \end{abstractclass}
                
                \begin{class}[text width=\largeTextWidth]{NullEwaldReal}{0, -2}
                    \inherit{AbstractEwaldReal}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{volumeChangeUpdate(dilatation : double)}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}
                
                \begin{class}[text width=\largeTextWidth]{EwaldReal}{0, -7.5}
                    \inherit{AbstractEwaldReal}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{volumeChangeUpdate(dilatation : double)}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}

                \begin{class}[text width=\largeTextWidth]{InterEwaldReal}{0, -13}
                    \inherit{AbstractEwaldReal}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{volumeChangeUpdate(dilatation : double)}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}
            \end{scope}
            
            \begin{scope}[shift={($(DipolarInteraction.south) + (-6.5 cm, -2 cm)$)}]
                \begin{abstractclass}[text width=\largeTextWidth]{AbstractEwaldReci}{0, 0}
                    \inherit{AbstractReciInteraction}
                \end{abstractclass}
                
                \begin{class}[text width=\largeTextWidth]{NullEwaldReci}{0, -2}
                    \inherit{AbstractEwaldReci}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{reset()}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{moveUpdate()}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationUpdate()}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{exchangeUpdate()}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{volumeChangeUpdate(dilatation : double)}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}
                
                \begin{class}[text width=\largeTextWidth]{EwaldReci}{0, -9}
                    \inherit{AbstractEwaldReci}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{reset()}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{moveUpdate()}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationUpdate()}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{exchangeUpdate()}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{volumeChangeUpdate(dilatation : double)}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}

                \begin{class}[text width=\largeTextWidth]{InterEwaldReci}{0, -16}
                    \inherit{AbstractEwaldReci}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{reset()}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{moveUpdate()}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationUpdate()}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{exchangeUpdate()}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{volumeChangeUpdate(dilatation : double)}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}
            \end{scope}
            
            \begin{scope}[shift={($(DipolarInteraction.south) + (6.5 cm, -2 cm)$)}]
                \begin{abstractclass}[text width=\largeTextWidth]{AbstractDipolarLayerCorrection}{0, 0}
                    \inherit{AbstractReciInteraction}
                \end{abstractclass}
                
                \begin{class}[text width=\largeTextWidth]{NullDipolarLayerCorrection}{0, -2}
                    \inherit{AbstractDipolarLayerCorrection}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{reset()}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{moveUpdate()}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationUpdate()}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{exchangeUpdate()}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{volumeChangeUpdate(dilatation : double)}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}
                
                \begin{class}[text width=\largeTextWidth]{DipolarLayerCorrection}{0, -9}
                    \inherit{AbstractDipolarLayerCorrection}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{reset()}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{moveUpdate()}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationUpdate()}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{exchangeUpdate()}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{volumeChangeUpdate(dilatation : double)}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}

                \begin{class}[text width=\largeTextWidth]{InterDipolarLayerCorrection}{0, -16}
                    \inherit{AbstractDipolarLayerCorrection}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{reset()}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{moveUpdate()}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationUpdate()}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{exchangeUpdate()}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{volumeChangeUpdate(dilatation : double)}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}
            \end{scope}
            
            \begin{scope}[shift={($(DipolarInteraction.south) + (19.5 cm, -2 cm)$)}]
                \begin{abstractclass}[text width=\largeTextWidth]{AbstractEwaldSelf}{0, 0}
                    \inherit{AbstractDipolarInteraction}
                \end{abstractclass}
                
                \begin{class}[text width=\largeTextWidth]{NullEwaldSelf}{0, -2}
                    \inherit{AbstractEwaldSelf}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}
                
                \begin{class}[text width=\largeTextWidth]{EwaldSelf}{0, -7}
                    \inherit{AbstractEwaldSelf}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}
                
            \end{scope}
            
            \begin{scope}[shift={($(DipolarInteraction.south) + (32.5 cm, -2 cm)$)},
                local bounding box=EwaldBound]
                \begin{abstractclass}[text width=\largeTextWidth]{AbstractEwaldBound}{0, 0}
                    \inherit{AbstractDipolarInteraction}
                \end{abstractclass}
                
                \begin{class}[text width=\largeTextWidth]{NullEwaldBound}{0, -2}
                    \inherit{AbstractEwaldBound}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}
                
                \begin{class}[text width=\largeTextWidth]{EwaldBound}{0, -7}
                    \inherit{AbstractEwaldBound}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}

                \begin{class}[text width=\largeTextWidth]{InterEwaldBound}{0, -12}
                    \inherit{AbstractEwaldBound}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}
            \end{scope}

            \begin{scope}[shift={($(DipolarInteraction.south) + (45.5 cm, -2 cm)$)},
                local bounding box=FieldInteraction]
                \begin{abstractclass}[text width=\largeTextWidth]{AbstractFieldInteraction}{0, 0}
                    \inherit{AbstractDipolarInteraction}
                \end{abstractclass}

                \begin{class}[text width=\largeTextWidth]{NullFieldInteraction}{0, -2}
                    \inherit{AbstractFieldInteraction}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}

                \begin{class}[text width=\largeTextWidth]{FieldInteraction}{0, -7}
                    \inherit{AbstractFieldInteraction}
                    \operation{totalEnergy() : double}
                    \operation{totalEnergyUsingField() : double}
                    \operation{moveEnergy(old : Particle, new : Particle) : double}
                    \operation{rotationEnergy(old : Particle, new : Particle) : double}
                    \operation{exchangeEnergy(particle : Particle) : double}
                    \operation{volumeChangeEnergy(dilatation : double) : double}
                    \operation{soloField(particle : Particle) : double[3]}
                    \operation{testField(particle : Particle) : double[3]}
                \end{class}
            \end{scope}

            \begin{scope}[shift={($(EwaldBound.south)!0.5!(FieldInteraction.south) + (0 cm, -7 cm)$)}]
                \begin{abstractclass}[text width=\smallTextWidth]{AbstractTotalMoment}{0, 0}
                    \operation[0]{getTotalMoment() : double[3]}
                    \operation[0]{rotationUpdate()}
                    \operation[0]{exchangeUpdate()}
                \end{abstractclass}

                \begin{class}[text width=\smallTextWidth]{NullTotalMoment}{0, -3}
                    \inherit{AbstractTotalMoment}
                    \operation{getTotalMoment() : double[3]}
                    \operation{rotationUpdate()}
                    \operation{exchangeUpdate()}
                \end{class}

                \begin{class}[text width=\smallTextWidth]{TotalMoment}{0, -5.5}
                    \inherit{AbstractTotalMoment}
                    \operation{getTotalMoment() : double[3]}
                    \operation{rotationUpdate()}
                    \operation{exchangeUpdate()}
                \end{class}
            \end{scope}

            \begin{scope}[shift={($(EwaldBound.south)!0.5!(FieldInteraction.south) + (13 cm, -7 cm)$)}]
                \begin{abstractclass}[text width=\mediumTextWidth]{AbstractExternalField}{0, 0}
                    \operation[0]{field(position : double[3]) : double[3]}
                \end{abstractclass}

                \begin{class}[text width=\mediumTextWidth]{NullExternalField}{0, -2.5}
                    \inherit{AbstractExternalField}
                    \operation{field(position : double[3]) : double[3]}
                \end{class}

                \begin{class}[text width=\mediumTextWidth]{NonUniformExternalField}{0, -4.5}
                    \inherit{AbstractExternalField}
                    \operation{field(position : double[3]) : double[3]}
                \end{class}
            \end{scope}
        
        \end{package}
    \end{scope}

    \begin{scope}[on background layer]
        \composition{DipolarInteractionFacade}{ewaldRead}{1}{AbstractEwaldReal}
        \composition{DipolarInteractionFacade}{ewaldReci}{1}{AbstractEwaldReci}
        \composition{DipolarInteractionFacade}{dlc}{1}{AbstractDipolarLayerCorrection}
        \composition{DipolarInteractionFacade}{ewaldSelf}{1}{AbstractEwaldSelf}
        \composition{DipolarInteractionFacade}{ewaldBound}{1}{AbstractEwaldBound}
        \composition{DipolarInteractionFacade}{fieldInteraction}{1}{AbstractFieldInteraction}

        \composition{AbstractDipolarInteraction}{box}{1}{AbstractBoxGeometry}

        \composition{EwaldReal}{spheres}{1}{AbstractSpheres}
        \composition{InterEwaldReal}{spheres}{2}{AbstractSpheres}
        \composition{InterEwaldReal}{interSpheres}{1}{AbstractInterSpheres}

        \composition{EwaldReci}{spheres}{1}{AbstractSpheres}
        \composition{InterEwaldReci}{spheres}{2}{AbstractSpheres}

        \composition{DipolarLayerCorrection}{spheres}{1}{AbstractSpheres}
        \composition{InterDipolarLayerCorrection}{spheres}{2}{AbstractSpheres}

        \composition{EwaldSelf}{spheres}{1}{AbstractSpheres}

        \composition{EwaldBound}{totalMoment}{1}{AbstractTotalMoment}
        \composition{InterEwaldBound}{totalMoment}{2}{AbstractTotalMoment}

        \composition{FieldInteraction}{totalMoment}{1}{AbstractTotalMoment}
        \composition{FieldInteraction}{extField}{1}{AbstractExternalField}

        \composition{AbstractTotalMoment}{spheres}{1}{AbstractSpheres}
    \end{scope}[on background layer]

\end{tikzpicture}
