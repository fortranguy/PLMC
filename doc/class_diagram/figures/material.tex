\begin{scope}[local bounding box=Material]
    \begin{package}{Material}
    
        % deprecated
        \begin{scope}[opacity=0.5]
            \begin{abstractclass}[text width=\smallTextWidth]{AbstractDipolarSpheres}{0, 0}
                \operation[0]{getMomentNorm()\type{double}}
                \operation{getNumSpheres()\type{int}}
                \operation{remove()}
                \operation{add()}
            \end{abstractclass}
        \end{scope}
        
        \begin{scope}
            \begin{abstractclass}[text width=\largeTextWidth]{AbstractPeriodicBox}{0, 0}
                \operation{getSize()\type{double[3]}}
                \operation{getWave()\type{int}[3]}
                \operation[0]{vectorPBC(position1\type{double[3]}, 
                                        position2\type{double[3]})\type{double[3]}}
                \operation{distancePBC(position1\type{double[3]}, 
                                       position2\type{double[3]})\type{double}}
            \end{abstractclass}

            \def\operationsImplementation{
                \operation{vectorPBC(position1\type{double[3]}, 
                                     position2\type{double[3]})\type{double[3]}}
            }
            
            \begin{class}[text width=\largeTextWidth]{XYZPeriodic}{0, -4}
                \inherit{AbstractPeriodicBox}
                \operationsImplementation{}
            \end{class}
            
            \begin{class}[text width=\largeTextWidth]{XYPeriodic}{0, -6}
                \inherit{AbstractPeriodicBox}
                \operationsImplementation{}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={($(AbstractPeriodicBox.north) + (20 cm, 0 cm)$)}]
            \begin{abstractclass}[text width=\smallTextWidth]{AbstractSphere}{0, 0}
                \operation{getDiameter()\type{double}}
            \end{abstractclass}
        \end{scope}
        
        \begin{scope}[shift={($(AbstractSphere.north) + (-7 cm, 0 cm)$)}]
            \begin{abstractclass}[text width=\smallTextWidth]{AbstractParticlesNumber}{0, 0}
                \operation{setNum(num\type{int})}
                \operation{getNum()\type{int}}
            \end{abstractclass}
        \end{scope}

        \begin{scope}[shift={($(AbstractSphere.north) + (7 cm, 0 cm)$)}]
            \begin{abstractclass}[text width=\smallTextWidth]{AbstractDipolarMoment}{0, 0}
                \operation{getNorm()\type{double}}
            \end{abstractclass}
        \end{scope}
        
        \begin{scope}[shift={($(AbstractSphere.north) + (-7 cm, 5 cm)$)}]
            \begin{abstractclass}[text width=\smallTextWidth]{AbstractInterSpheres}{0, 0}
                \operation[0]{getDiameter()\type{double}}
            \end{abstractclass}
            
            \def\operationsImplementation{
                \operation{getDiameter()\type{double}}
            }
            
            \begin{class}[text width=\smallTextWidth]{InterSpheres}{0, -2}
                \inherit{AbstractInterSpheres}
                \operationsImplementation{}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={($(AbstractSphere.north) + (0 cm, 5 cm)$)}]
            \begin{abstractclass}[text width=\mediumTextWidth]{AbstractPositions}{0, 0}
                \operation{getPosition(iSphere\type{int})\type{double[3]}}
                \operation{setPosition(iSphere\type{int}, position\type{double[3]})}
                \operation{add(position\type{double[3]})}
                \operation{remove(iSphere\type{int})}
            \end{abstractclass}
        \end{scope}

        \begin{scope}[shift={($(AbstractSphere.north) + (8 cm, 5 cm)$)}]
            \begin{abstractclass}[text width=\mediumTextWidth]{AbstractOrientations}{0, 0}
                \operation{getOrientation(iSphere\type{int})\type{double[3]}}
                \operation{setOrientation(iSphere\type{int}, orientation\type{double[3]})}
                \operation{add(orientation\type{double[3]})}
                \operation{remove(iSphere\type{int})}
            \end{abstractclass}
        \end{scope}
        
        \begin{scope}[shift={($(AbstractPeriodicBox.north) - (11 cm, 0)$)}]
            \begin{abstractclass}[text width=\mediumTextWidth]{AbstractExternalField}{0, 0}
                \operation[0]{field(position\type{double[3]})\type{double[3]}}
            \end{abstractclass}

            \def\operationsImplementation{
                \operation{field(position\type{double[3]})\type{double[3]}}
            }

            \begin{class}[text width=\mediumTextWidth]{ConstantExternalField}{0, -2.5}
                \inherit{AbstractExternalField}
                \operationsImplementation{}
            \end{class}

            \begin{class}[text width=\mediumTextWidth]{NonUniformExternalField}{0, -4.5}
                \inherit{AbstractExternalField}
                \operationsImplementation{}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={($(AbstractPeriodicBox.north) - (20 cm, 0)$)}]
            \begin{abstractclass}[text width=\mediumTextWidth]{AbstractSpheresReservoir}{0, 0}
                \operation[0]{getDensity()\type{double}}
                \operation[0]{getExcessChemicalPotential()\type{double}}
            \end{abstractclass}
            
            \def\operationsImplementation{
                \operation{getDensity()\type{double}}
                \operation{getExcessChemicalPotential()\type{double}}
            }
            
            \begin{class}[text width=\mediumTextWidth]{SpheresReservoir}{0, -3}
                \inherit{AbstractSpheresReservoir}
                \operationsImplementation{}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={($(AbstractPeriodicBox.north) - (28 cm, 0)$)}]
            \begin{abstractclass}[text width=\smallTextWidth]{AbstractThermostat}{0, 0}
                \operation[0]{getTemperature()\type{double}}
            \end{abstractclass}
            
            \def\operationsImplementation{
                \operation{getTemperature()\type{double}}
            }
            
            \begin{class}[text width=\smallTextWidth]{Thermostat}{0, -2.5}
                \inherit{AbstractThermostat}
                \operationsImplementation{}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={($(AbstractPeriodicBox.north) + (0 cm, 16 cm)$)}]
            \begin{abstractclass}[text width=\mediumTextWidth]{AbstractBoxedSpheres}{0, 0}
                \operation[0]{accessibleVolume()\type{double}}
                \operation[0]{isInside(position\type{double[3]})\type{bool}}
                \operation[0]{fold(position\type{double[3]})}
            \end{abstractclass}

            \def\operationsImplementation{
                \operation{accessibleVolume()\type{double}}
                \operation{isInside(position\type{double[3]})\type{bool}}
                \operation{fold(position\type{double[3]})}
            }
            
            \begin{class}[text width=\mediumTextWidth]{BulkBoxedSpheres}{0, -3.5}
                \inherit{AbstractBoxedSpheres}
                \operationsImplementation{}
            \end{class}
            
            \begin{class}[text width=\mediumTextWidth]{SlabBoxedSpheres}{0, -6.5}
                \inherit{AbstractBoxedSpheres}
                \operationsImplementation{}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={($(AbstractPositions.north) + (0, 8 cm)$)}]
            \begin{abstractclass}[text width=\smallTextWidth]{AbstractRandomPositions}{0, 0}
                \operation[0]{position()\type{double[3]}}
                \operation{move(iSphere\type{int})\type{double[3]}}
            \end{abstractclass}
            
            \def\operationsImplementation{
                \operation{position()\type{double[3]}}
            }
            
            \begin{class}[text width=\smallTextWidth]{BulkRandomPositions}{0, -3}
                \inherit{AbstractRandomPositions}
                \operationsImplementation{}
            \end{class}
            
            \begin{class}[text width=\smallTextWidth]{SlabRandomPositions}{0, -5}
                \inherit{AbstractRandomPositions}
                \operationsImplementation{}
            \end{class}            
        \end{scope}
        
        \begin{scope}[shift={($(AbstractOrientations.north) + (0 cm, 8 cm)$)}]
            \begin{abstractclass}[text width=\mediumTextWidth]{AbstractRandomOrientations}{0, 0}
                \operation[0]{orientation()\type{double[3]}}
                \operation[0]{rotation(iSphere\type{int})\type{double[3]}}
            \end{abstractclass}
            
            \def\operationImplementation{
                \operation{orientation()\type{double[3]}}
                \operation{rotation(iSphere\type{int})\type{double[3]}}
            }
            
            \begin{class}[text width=\mediumTextWidth]{NullRandomOrientations}{0, -3}
                \inherit{AbstractRandomOrientations}
                \operationImplementation{}
            \end{class}
            
            \begin{class}[text width=\mediumTextWidth]{RandomOrientations}{0, -5.5}
                \inherit{AbstractRandomOrientations}
                \operationImplementation{}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={
            ($(AbstractRandomPositions.north)!0.5!(AbstractRandomOrientations.north) + 
            (0 cm, 4 cm)$)}]
            \begin{class}[text width=\mediumTextWidth]{RandomCoordinatesFacade}{0, 0}
                \operation{position()\type{double[3]}}
                \operation{moment()\type{double[3]}}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={($(RandomCoordinatesFacade.north) + (14 cm, 0 cm)$)}]
            \begin{class}[text width=\largeTextWidth]{SphereExchangeFacade}{0, 0}
                \operation{add(iSphere\type{int}, position\type{double[3]}, orientation\type{double[3]})}
                \operation{remove(iSphere\type{int})}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={($(AbstractExternalField.north) + (0 cm, 16 cm)$)}]
            \begin{abstractclass}[text width=\mediumTextWidth]{AbstractTotalMoment}{0, 0}
                \operation[0]{getTotalMoment()\type{double[3]}}
                \operation[0]{rotationUpdate(old\type{Particle}, new\type{Particle})}
                \operation[0]{exchangeUpdate(particle\type{Particle})}
            \end{abstractclass}

            \def\operationsImplementation{
                \operation{getTotalMoment()\type{double[3]}}
                \operation{rotationUpdate(old\type{Particle}, new\type{Particle})}
                \operation{exchangeUpdate(particle\type{Particle})}
            }

            \begin{class}[text width=\mediumTextWidth]{NullTotalMoment}{0, -3.5}
                \inherit{AbstractTotalMoment}
                \operationsImplementation{}
            \end{class}

            \begin{class}[text width=\mediumTextWidth]{TotalMoment}{0, -6.5}
                \inherit{AbstractTotalMoment}
                \operationsImplementation{}
            \end{class}
        \end{scope}
        
    \end{package}
\end{scope}

\begin{scope}[on background layer]
    \aggregation{AbstractBoxedSpheres}{box}{1}{AbstractPeriodicBox}
    \aggregation{AbstractBoxedSpheres}{dipSpheres}{1}{AbstractDipolarSpheres}
    \aggregation{AbstractInterSpheres}{sphere}{2}{AbstractSphere}
    \aggregation{AbstractPositions}{number}{1}{AbstractParticlesNumber}
    \aggregation{AbstractOrientations}{number}{1}{AbstractParticlesNumber}
    \aggregation{SphereExchangeFacade}{dipSpheres}{1}{AbstractDipolarSpheres}
    \aggregation{SphereExchangeFacade}{positions}{1}{AbstractPositions}
    \aggregation{SphereExchangeFacade}{orientations}{1}{AbstractOrientations}
    
    \aggregation{RandomCoordinatesFacade}{randPositions}{1}{AbstractRandomPositions}
    \aggregation{RandomCoordinatesFacade}{randMoments}{1}{AbstractRandomOrientations}
    
    \aggregation{AbstractRandomPositions}{box}{1}{AbstractPeriodicBox}
    \aggregation{AbstractRandomPositions}{dipSpheres}{1}{AbstractDipolarSpheres}
    
    \aggregation{RandomOrientations}{dipSpheres}{1}{AbstractDipolarSpheres}
    
    \aggregation{TotalMoment}{dipSpheres}{1}{AbstractDipolarSpheres}
\end{scope}
