\begin{scope}[shift={($(Material.north) + (-28 cm, 55 cm)$)}, opacity=0.5]
    \begin{package}{Short range interactions}
    
        \begin{scope}
            \begin{abstractclass}[text width=\extraLargeTextWidth]{AbstractShortInteraction}{0, 0}
                \operation[0]{totalEnergy() : double}
                \operation[0]{soloEnergy(particle : Particle, overlap : bool, energy : double)}
                \operation[0]{volumeChangeEnergy(dilatation : double, overlap : bool, energy : double)}
                \operation[0]{overlapTest()}
            \end{abstractclass}
        \end{scope}
    
        \begin{scope}[shift={($(AbstractShortInteraction.south) + (-8 cm, -2.5 cm)$)}]
            \begin{class}[text width=\largeTextWidth]{PairPotentialFacade}{0, 0}
                \operation{construct(cellsPotential\type{AbstractCellsPotential},
                                     boxPotential\type{AbstractBoxPotential})}
                \operation{destroy()}
                \operation{visitCells(particle\type{Particle}, overlap\type{bool},
                                      energy\type{double})}
                \operation{visitBox(particle\type{Particle}, overlap\type{bool},
                                    energy\type{double})}
            \end{class}
        \end{scope}

        \begin{scope}[shift={($(PairPotentialFacade.south) + (5 cm, -2 cm)$)}]
            \begin{abstractclass}[text width=\mediumTextWidth]{AbstractBoxPotential}{0, 0}
                \operation{construct(pairPotential\type{AbstractPairPotential})}
                \operation{destroy()}
                \operation{visit(particle\type{Particle}, overlap\type{bool}, energy\type{double})}
            \end{abstractclass}
        \end{scope}
        
        \begin{scope}[shift={($(PairPotentialFacade.south) + (-7 cm, -2 cm)$)}]
            \begin{abstractclass}[text width=\largeTextWidth]{AbstractCellsPotential}{0, 0}
                \operation{construct(periodicBox\type{AbstractPeriodicBox},
                                     positions\type{AbstractPositions},
                                     pairPotential\type{AbstractPairPotential},
                                     visitableList\type{AbstractVisitableList})}
                \operation{destroy()}
                \operation{set(particle\type{Particle}, iParticle\type{int})}
                \operation[0]{visit(particle\type{Particle}, overlap\type{bool},
                                    energy\type{double})}
                \operation{add(particle\type{Particle})}
                \operation{remove(particle\type{Particle})}
            \end{abstractclass}

            \def\operationsImplementation{
                \operation{visit(particle\type{Particle}, overlap\type{bool},
                                 energy\type{double})}
            }
            
            \begin{class}[text width=\largeTextWidth]{XYZCellsPotential}{0, -6}
                \inherit{AbstractCellsPotential}
                \operationsImplementation{}
            \end{class}
            
            \begin{class}[text width=\largeTextWidth]{XYCellsPotential}{0, -8}
                \inherit{AbstractCellsPotential}
                \operationsImplementation{}
            \end{class}
        \end{scope}

        \begin{scope}[shift={($(AbstractCellsPotential.north) + (-13 cm, -3cm)$)}]
            \begin{abstractclass}[text width=\largeTextWidth]{AbstractVisitableList}{0, 0}
                \operation{construct(periodicBox\type{AbstractPeriodicBox},
                                     positions\type{AbstractPositions},
                                     potentialDomain\type{AbstractPotentialDomain})}
                \operation{destroy()}
                \operation{set(iTarger\type{int}, iSource\type{int})}
                \operation{visit(iParticle\type{int}, overlap\type{bool}, energy\type{double})}
                \operation{add(iParticle\type{int})}
                \operation{remove(iParticle\type{int})}
            \end{abstractclass}
        \end{scope}
        
        \begin{scope}[shift={($(AbstractBoxPotential.south) + (0 cm, -2 cm)$)}]
            \begin{abstractclass}[text width=\mediumTextWidth]{AbstractPairPotential}{0, 0}
                \operation{construct(potentialExpression\type{AbstractPotentialExpression},
                                     maxDistance\type{double}, deltaDistance\type{double})}
                                     %minDistance? What if varies?
                \operation{destroy()}
                \operation{getMaxDistance()}
                \operation{meet(minDistance\type{double}, distance\type{double}, overlap\type{bool},
                                energy\type{double})\type{void}}
            \end{abstractclass}
        \end{scope}

        \begin{scope}[shift={($(AbstractPairPotential.south) + (0 cm, -1.5 cm)$)}]
        \begin{abstractclass}[text width=\mediumTextWidth]{AbstractPotentialExpression}{0, 0}
                \operation{get(distance : double) : double}
            \end{abstractclass}
        \end{scope}
        
        \begin{scope}[shift={($(AbstractShortInteraction.south) + (8 cm, -2.5 cm)$)}]
            \begin{abstractclass}[text width=\extraLargeTextWidth]{AbstractWallsInteraction}{0, 0}
                \inherit{AbstractShortInteraction}
            \end{abstractclass}
            
            \def\operationsImplementation{
                \operation{totalEnergy() : double}
                \operation{soloEnergy(particle : Particle, overlap : bool, energy : double)}
                \operation{volumeChangeEnergy(dilatation : double, overlap : bool, energy : double)}
                \operation{overlapTest()}
            }
            
            \begin{class}[text width=\extraLargeTextWidth]{NullWallsInteraction}{0, -2}
                \inherit{AbstractWallsInteraction}
                \operationsImplementation{}
            \end{class}
            
            \begin{class}[text width=\extraLargeTextWidth]{tWallsInteraction}{0, -5.5}
                \inherit{AbstractWallsInteraction}
                \operationsImplementation{}
            \end{class}
        \end{scope}
        
        \begin{scope}[shift={($(AbstractWallsInteraction.south) + (8 cm, -3.5 cm)$)}]
            \begin{abstractclass}[text width=\mediumTextWidth]{AbstractWallsPotential}{0, 0}
                \operation[0]{potential(height : double) : double}
            \end{abstractclass}
            
            \def\operationsImplementation{
                \operation{potential(height : double) : double}
            }
            
            \begin{class}[text width=\mediumTextWidth]{HardWallsPotential}{0, -2.5}
                \inherit{AbstractWallsPotential}
                \operationsImplementation{}
            \end{class}
            
            \begin{class}[text width=\mediumTextWidth]{SoftWallsPotential}{0, -4.5}
                \inherit{AbstractWallsPotential}
                \operationsImplementation{}
            \end{class}
        \end{scope}
    
    \end{package}
\end{scope}

\begin{scope}[on background layer]
    %\aggregation{PairPotentialFacade}{periodicBox}{1}{AbstractPeriodicBox}
    \aggregation{PairPotentialFacade}{cellsPotential}{1}{AbstractCellsPotential}
    \aggregation{PairPotentialFacade}{boxPotential}{1}{AbstractBoxPotential}
    \aggregation{AbstractBoxPotential}{pairPotential}{1}{AbstractPairPotential}
    %\aggregation{IntraPairInteration}{diameters}{1}{AbstractDiameters}
    %\aggregation{IntraPairInteration}{positions}{1}{AbstractPositions}
    %\aggregation{InterPairInteration}{interDiameters}{1}{AbstractInterDiameters}
    %\aggregation{InterPairInteration}{positions}{2}{AbstractPositions}

    \aggregation{AbstractCellsPotential}{visitableList}{1}{AbstractVisitableList}
    \aggregation{AbstractVisitableList}{pairPotential}{1}{AbstractPairPotential}
    
    \aggregation{AbstractPairPotential}{potentialExpression}{1}{AbstractPotentialExpression}

    \aggregation{AbstractCellsPotential}{periodicBox}{1}{AbstractPeriodicBox}
    \aggregation{AbstractCellsPotential}{positions}{1}{AbstractPositions}
    \aggregation{AbstractCellsPotential}{pairPotential}{1}{AbstractPairPotential}
    
    \composition{AbstractWallsInteraction}{wallsPotential}{1}{AbstractWallsPotential}
    \aggregation{AbstractWallsInteraction}{periodicBox}{1}{AbstractPeriodicBox}
    \aggregation{AbstractWallsInteraction}{positions}{1}{AbstractPositions}
\end{scope}
